!function(r,e){"function"==typeof define&&define.amd?define(["jQuery"],e):"object"==typeof exports?module.exports=e(require("jquery/dist/jquery")(window)):r.bitcoinprices=e(r.jQuery)}(this,function(r){"use strict";var e=r,t={url:"https://api.bitcoinaverage.com/ticker/all",marketRateVariable:"24h_avg",currencies:["BTC","USD","EUR","CNY"],symbols:{},clickablePriceSelector:null,defaultCurrency:"BTC",ux:{clickPrices:!0,menu:!0,clickableCurrencySymbol:!0},priceAttribute:"data-btc-price",priceOrignalCurrency:"BTC"};return{data:null,config:null,loadData:function(){var r=this;e.getJSON(r.config.url,function(t){r.data=t,e(document).trigger("marketdataavailable")}).error(function(){throw new Error("Could not load exchage rate data from:"+r.config.url)})},convert:function(r,t,c){var i;if(!e.isNumeric(r))throw new Error("Amount must be numeric");if(!t||!c)throw new Error("You need to give both source and target currency:"+t+" "+c);if("BTC"==t&&"BTC"==c)return r;if("BTC"!=t&&"BTC"!=c)return this.convert(this.convert(r,t,"BTC"),"BTC",c);if("BTC"==t?(i=!0,c=[t,t=c][0]):i=!1,!this.data)throw new Error("Exchange rate data not available");var n=this.data[t];if(!n)throw new Error("We do not have market data for currency: "+t);var a=n[this.config.marketRateVariable];if(!a)throw new Error("Cannot parse bitcoinaverage data for "+t+" "+this.config.url);return i?r*a:r/a},formatPrice:function(r,e,t){var c;c="BTC"==e?8:2;var i=r.toFixed(c);return t&&(i+=" "+this.getCurrencySymbol(e)),i},getCurrencySymbol:function(r){var e=(this.config.symbols||{},this.config.symbols[r]||r);return e},updatePrices:function(){var r=this,t=this.getActiveCurrency(),c=this.config;e("["+c.priceAttribute+"]").each(function(){var i=e(this),n=i.attr(c.priceAttribute);try{n=parseFloat(n,10)}catch(a){return}var o="off"!=i.attr("data-price-symbol"),u=r.convert(n,c.priceOrignalCurrency,t);i.html(r.formatPrice(u,t,o))})},updateCurrencySymbols:function(){e(".current-currency-symbol").html(this.getCurrencySymbol(this.getActiveCurrency()))},getActiveCurrency:function(){return window.localStorage["bitcoinprices.currency"]||this.config.defaultCurrency||"BTC"},resetCurrency:function(){var r=this.getActiveCurrency(),t=e.inArray(r,this.config.currencies);0>t&&(window.localStorage["bitcoinprices.currency"]="BTC")},toggleNextActiveCurrency:function(){var r=this.getActiveCurrency(),t=e.inArray(r,this.config.currencies);return 0>t&&(t=0),t=++t%this.config.currencies.length,r=window.localStorage["bitcoinprices.currency"]=this.config.currencies[t]},installClicker:function(){function r(r){r.preventDefault(),t.toggleNextActiveCurrency(),e(document).trigger("activecurrencychange")}var t=this,c=this.config.clickablePriceSelector||"["+this.config.priceAttribute+"]";e(c).addClass("clickable-price"),this.config.ux.clickableCurrencySymbol&&e(".current-currency-symbol").addClass("clickable-price"),e(".clickable-price").click(r)},installCurrencyMenu:function(){function r(r){var e=c.getCurrencySymbol(r);i.find(".currency-symbol").html(e),i.find("li[data-currency]").removeClass("active"),i.find("li[data-currency="+r+"]").addClass("active")}function t(){e.each(c.config.currencies,function(){var r=c.getCurrencySymbol(this),e=["<li class='currency-menu-entry' data-currency='",this,"'><a role='menuitem'>",r,"</a></li>"],t=e.join("");i.find("ul").append(t)})}var c=this,i=e(".currency-dropdown");t(),e(document).on("activecurrencychange",function(){var e=c.getActiveCurrency();r(e)}),i.on("click",".currency-menu-entry",function(){var r=e(this).attr("data-currency");window.localStorage["bitcoinprices.currency"]=r,e(document).trigger("activecurrencychange")});var n=this.getActiveCurrency();r(n)},installUX:function(){var r=this;r.config.ux.clickPrices&&this.installClicker(),r.config.ux.menu&&this.installCurrencyMenu(),e(document).bind("activecurrencychange",function(){r.updatePrices(),r.updateCurrencySymbols()})},init:function(r){if(!r)throw new Error("You must give config object");var c=this;r.jQuery&&(e=r.jQuery),this.config=e.extend({},t,r),this.config.url&&(e(document).bind("marketdataavailable",function(){c.updatePrices(),c.updateCurrencySymbols(),c.installUX()}),this.loadData())}}});